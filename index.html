<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>ERIZONT</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      text-align: center;
      font-size: 32px;
      padding: 10px;
      background-color: #111;
      font-weight: bold;
      color: #00ccff;
    }

    main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    #menu-esquerdo {
      width: 300px;
      background-color: #111;
      overflow-y: auto;
      padding: 10px;
      border-right: 1px solid #222;
    }

    .grupo-btn {
      background-color: #222;
      color: #00ccff;
      border: 1px solid #00ccff;
      padding: 6px 10px;
      width: 100%;
      text-align: left;
      font-weight: bold;
      margin-top: 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    .grupo-itens {
      display: none;
      padding-left: 10px;
      margin-top: 5px;
    }

    .grupo-itens button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 5px 8px;
      margin: 2px 0;
      background: #222;
      color: #00ff88;
      border: 1px solid #00ff88;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    #player-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px;
      position: relative;
    }

    video {
      width: 90%;
      max-width: 720px;
      max-height: 400px;
      background: black;
      border: 3px solid #00ff88;
      border-radius: 10px;
    }

    #qrcode-container {
      margin-top: 20px;
      text-align: center;
    }

    #qrcode-container img {
      width: 120px;
      height: 120px;
      display: block;
      margin: 0 auto 8px;
    }

    #qrcode-container p {
      font-size: 14px;
      color: #aaa;
    }

    #loading-bar {
      height: 4px;
      width: 0%;
      background: linear-gradient(to right, #00ccff, #00ff88);
      transition: width 0.4s ease;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
      }

      #menu-esquerdo {
        width: 100%;
        height: 200px;
        overflow-y: auto;
        border-right: none;
        border-bottom: 1px solid #222;
      }

      video {
        width: 95%;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <header>ERIZONT</header>
  <div id="loading-bar"></div>
  <main>
    <div id="menu-esquerdo"></div>
    <div id="player-container">
      <video id="player" controls autoplay></video>
      <div id="qrcode-container">
        <img src="qrcode.png" alt="QR Code para doação">
        <p>Ajude o projeto com uma doação!</p>
      </div>
    </div>
  </main>

  <script>
    const m3uUrl = "http://atmck.xyz:80/get.php?username=549098716&password=990251878&type=m3u_plus&output=mpegts";

    function carregarM3U() {
      mostrarBarraCarregamento();
      fetch(m3uUrl)
        .then(res => res.text())
        .then(texto => {
          const grupos = {};
          const linhas = texto.split('\n');
          let nome = "", grupo = "", url = "";

          for (let i = 0; i < linhas.length; i++) {
            const linha = linhas[i].trim();

            if (linha.startsWith('#EXTINF')) {
              const info = linha.match(/#EXTINF:-1.*?group-title="(.*?)".*?,(.*)/);
              grupo = info ? info[1].trim() : "Desconhecido";
              nome = info ? info[2].trim() : "Sem nome";
            } else if (linha.startsWith('http')) {
              url = linha;
              if (!grupos[grupo]) grupos[grupo] = [];
              grupos[grupo].push({ nome, url });
            }
          }

          const container = document.getElementById("menu-esquerdo");
          container.innerHTML = "";

          Object.keys(grupos).sort().forEach(grupo => {
            const btnGrupo = document.createElement("button");
            btnGrupo.className = "grupo-btn";
            btnGrupo.textContent = `${grupo} (${grupos[grupo].length})`;

            const divItens = document.createElement("div");
            divItens.className = "grupo-itens";

            grupos[grupo].forEach(item => {
              const btn = document.createElement("button");
              btn.textContent = item.nome;
              btn.onclick = () => tocarItem(item.url);
              divItens.appendChild(btn);
            });

            btnGrupo.onclick = () => {
              divItens.style.display = divItens.style.display === "none" ? "block" : "none";
            };

            container.appendChild(btnGrupo);
            container.appendChild(divItens);
          });

          ocultarBarraCarregamento();
        })
        .catch(err => {
          console.error("Erro ao carregar conteúdo:", err);
          ocultarBarraCarregamento();
          document.getElementById("menu-esquerdo").innerHTML = "Erro ao carregar conteúdo.";
        });
    }

    function tocarItem(url) {
      const video = document.getElementById('player');
      video.src = "";
      video.load();

      if (Hls.isSupported() && url.includes(".m3u8")) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
      } else {
        video.src = url;
        video.addEventListener('loadedmetadata', () => video.play(), { once: true });
      }
    }

    function mostrarBarraCarregamento() {
      const bar = document.getElementById("loading-bar");
      bar.style.width = "0%";
      setTimeout(() => (bar.style.width = "100%"), 100);
    }

    function ocultarBarraCarregamento() {
      const bar = document.getElementById("loading-bar");
      setTimeout(() => (bar.style.width = "0%"), 500);
    }

    carregarM3U();
  </script>
</body>
</html>

